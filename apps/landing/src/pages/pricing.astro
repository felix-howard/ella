---
/**
 * Pricing page â€” 3 tiers (Starter, Professional, Enterprise) with comparison table and FAQ.
 * Professional tier elevated with "Most Popular" badge and visual emphasis.
 * Responsive: cards stack on mobile, table scrolls horizontally.
 */
import BaseLayout from "@/layouts/base-layout.astro";
import HeadSEO from "@/components/seo/head-seo.astro";
import SectionHeading from "@/components/section-heading.astro";
import CTASection from "@/components/cta-section.astro";
import {
  breadcrumbSchema,
  faqSchema,
} from "@/components/seo/structured-data";
import { siteConfig } from "@/config/site";

/* ---------- Structured Data ---------- */

const faqItems = [
  {
    question: "Do you offer a free trial?",
    answer:
      "Yes, all plans come with a 14-day free trial. No credit card required.",
  },
  {
    question: "Can I change plans later?",
    answer:
      "Absolutely. Upgrade or downgrade anytime. Changes take effect on your next billing cycle.",
  },
  {
    question: "What counts as an \u201Cactive client\u201D?",
    answer:
      "An active client is anyone with an open tax case during the current year. Archived clients don\u2019t count.",
  },
  {
    question: "What happens if I exceed my document limit?",
    answer:
      "You\u2019ll be notified at 80% usage. Overages are billed at $0.10/document. Upgrade anytime to increase your limit.",
  },
  {
    question: "Is there a setup fee?",
    answer:
      "No setup fees. Start using Ella immediately after signup.",
  },
  {
    question: "What payment methods do you accept?",
    answer:
      "We accept all major credit cards (Visa, Mastercard, Amex) and ACH for annual plans.",
  },
  {
    question: "Can I cancel anytime?",
    answer:
      "Yes, cancel anytime with no penalties. You\u2019ll retain access until the end of your billing period.",
  },
  {
    question: "Do you offer discounts for annual billing?",
    answer:
      "Yes, save 20% with annual billing. Contact us for a custom quote.",
  },
];

/** Product schema for each pricing tier (schema.org Offer) */
function productOfferSchema(
  name: string,
  description: string,
  price: string,
  priceCurrency: string
) {
  return {
    "@context": "https://schema.org",
    "@type": "Product",
    name: `${siteConfig.name} ${name}`,
    description,
    brand: { "@type": "Brand", name: siteConfig.name },
    offers: {
      "@type": "Offer",
      price,
      priceCurrency,
      priceValidUntil: `${new Date().getFullYear() + 1}-12-31`,
      availability: "https://schema.org/InStock",
      url: `${siteConfig.url}/pricing`,
    },
  };
}

const structuredData = [
  breadcrumbSchema([
    { name: "Home", url: siteConfig.url },
    { name: "Pricing", url: `${siteConfig.url}/pricing` },
  ]),
  faqSchema(faqItems),
  productOfferSchema(
    "Starter",
    "AI tax document management for solo practitioners. Up to 5 active clients.",
    "99",
    "USD"
  ),
  productOfferSchema(
    "Professional",
    "AI tax document management for growing firms. Up to 50 active clients with team collaboration.",
    "299",
    "USD"
  ),
  productOfferSchema(
    "Enterprise",
    "AI tax document management for large firms. Unlimited clients, custom integrations, dedicated support.",
    "0",
    "USD"
  ),
];

/* ---------- Pricing Tiers Data ---------- */

import { checkPath, xPath } from "@/lib/icons";

interface TierFeature {
  text: string;
  /** True for "Everything in X, plus:" label rows (no checkmark icon) */
  isLabel?: boolean;
}

interface Tier {
  name: string;
  target: string;
  price: string;
  billing: string;
  features: TierFeature[];
  cta: string;
  ctaHref: string;
  popular?: boolean;
  outline?: boolean;
}

const tiers: Tier[] = [
  {
    name: "Starter",
    target: "For solo practitioners",
    price: "$99",
    billing: "/month",
    features: [
      { text: "Up to 5 active clients" },
      { text: "AI document classification" },
      { text: "OCR data extraction" },
      { text: "Client magic link portal" },
      { text: "500 documents/month" },
      { text: "Email support" },
    ],
    cta: "Start Free Trial",
    ctaHref: "/#contact",
  },
  {
    name: "Professional",
    target: "For growing firms",
    price: "$299",
    billing: "/month",
    popular: true,
    features: [
      { text: "Up to 50 active clients" },
      { text: "Everything in Starter, plus:", isLabel: true },
      { text: "Team collaboration (5 staff)" },
      { text: "Voice & SMS communication" },
      { text: "Multi-year engagements" },
      { text: "2,000 documents/month" },
      { text: "Priority email support" },
    ],
    cta: "Start Free Trial",
    ctaHref: "/#contact",
  },
  {
    name: "Enterprise",
    target: "For large firms",
    price: "Custom",
    billing: "",
    outline: true,
    features: [
      { text: "Unlimited clients" },
      { text: "Everything in Professional, plus:", isLabel: true },
      { text: "Unlimited staff members" },
      { text: "Custom integrations" },
      { text: "Dedicated account manager" },
      { text: "SLA & uptime guarantee" },
      { text: "Unlimited documents" },
      { text: "Phone & Slack support" },
    ],
    cta: "Request Demo",
    ctaHref: "/#contact",
  },
];

/* ---------- Feature Comparison Data ---------- */

interface ComparisonRow {
  feature: string;
  starter: string;
  professional: string;
  enterprise: string;
}

const comparisonRows: ComparisonRow[] = [
  { feature: "Active clients", starter: "5", professional: "50", enterprise: "Unlimited" },
  { feature: "Staff members", starter: "1", professional: "5", enterprise: "Unlimited" },
  { feature: "Documents/month", starter: "500", professional: "2,000", enterprise: "Unlimited" },
  { feature: "AI classification", starter: "check", professional: "check", enterprise: "check" },
  { feature: "OCR extraction", starter: "check", professional: "check", enterprise: "check" },
  { feature: "Client portal", starter: "check", professional: "check", enterprise: "check" },
  { feature: "Team collaboration", starter: "x", professional: "check", enterprise: "check" },
  { feature: "Voice & SMS", starter: "x", professional: "check", enterprise: "check" },
  { feature: "Multi-year engagements", starter: "x", professional: "check", enterprise: "check" },
  { feature: "Priority support", starter: "x", professional: "check", enterprise: "check" },
  { feature: "Custom integrations", starter: "x", professional: "x", enterprise: "check" },
  { feature: "Dedicated account manager", starter: "x", professional: "x", enterprise: "check" },
];
---

<BaseLayout>
  <HeadSEO
    slot="head"
    title="Pricing - Ella Tax Document Management | Plans Starting at $99/mo"
    description="Transparent pricing for tax professionals. Plans start at $99/month for solo practitioners. 14-day free trial, no credit card required. Compare Starter, Professional, and Enterprise tiers."
    structuredData={structuredData}
  />

  <main>
    <!-- Hero Section -->
    <section class="pt-32 pb-16">
      <div class="mx-auto max-w-3xl px-6 text-center">
        <p
          class="mb-4 text-sm font-semibold uppercase tracking-widest text-primary-800"
          data-animate="fade-up"
        >
          Pricing
        </p>
        <h1
          class="text-4xl font-extrabold leading-tight tracking-tight text-gray-900 sm:text-5xl"
          data-animate="fade-up"
        >
          Simple, <span class="text-primary-600">transparent</span> pricing
        </h1>
        <p
          class="mx-auto mt-6 max-w-2xl text-lg leading-relaxed text-gray-600"
          data-animate="fade-up"
        >
          Choose the plan that fits your firm. All plans include AI
          classification, OCR extraction, and client portals.
        </p>
      </div>
    </section>

    <!-- Pricing Tiers -->
    <section class="pb-24" aria-label="Pricing plans">
      <div class="mx-auto max-w-6xl px-6">
        <div class="grid gap-8 lg:grid-cols-3" data-stagger>
          {
            tiers.map((tier) => (
              <div
                class:list={[
                  "relative flex flex-col rounded-2xl bg-white p-8 shadow-sm ring-1 transition-all duration-300 hover:-translate-y-1 hover:shadow-lg",
                  tier.popular
                    ? "ring-2 ring-primary-600 shadow-xl lg:scale-105"
                    : "ring-gray-200",
                ]}
                data-animate="fade-up"
              >
                {/* Most Popular badge */}
                {tier.popular && (
                  <span class="absolute -top-4 left-1/2 -translate-x-1/2 rounded-full bg-primary-600 px-4 py-1 text-xs font-semibold uppercase tracking-wide text-white">
                    Most Popular
                  </span>
                )}

                {/* Tier header */}
                <div class="mb-6">
                  <h3 class="text-lg font-semibold text-gray-900">
                    {tier.name}
                  </h3>
                  <p class="mt-1 text-sm text-gray-500">{tier.target}</p>
                </div>

                {/* Price */}
                <div class="mb-6">
                  <span class="text-4xl font-extrabold text-gray-900">
                    {tier.price}
                  </span>
                  {tier.billing && (
                    <span class="text-base text-gray-500">{tier.billing}</span>
                  )}
                </div>

                {/* CTA button */}
                <a
                  href={tier.ctaHref}
                  class:list={[
                    "mb-8 block rounded-full py-3 text-center text-sm font-semibold transition-colors focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary-500",
                    tier.outline
                      ? "border border-primary-600 text-primary-600 hover:bg-primary-50"
                      : "bg-primary-600 text-white hover:bg-primary-700",
                  ]}
                >
                  {tier.cta}
                </a>

                {/* Feature list */}
                <ul class="flex-1 space-y-3" role="list">
                  {tier.features.map((feat) => (
                    <li class="flex items-start gap-3">
                      {feat.isLabel ? (
                        <span class="mt-0.5 h-5 w-5 flex-shrink-0" />
                      ) : (
                        <svg
                          class="mt-0.5 h-5 w-5 flex-shrink-0 text-primary-600"
                          fill="none"
                          viewBox="0 0 24 24"
                          stroke="currentColor"
                          stroke-width="2"
                          aria-hidden="true"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d={checkPath}
                          />
                        </svg>
                      )}
                      <span
                        class:list={[
                          "text-sm",
                          feat.isLabel
                            ? "font-medium text-gray-900"
                            : "text-gray-600",
                        ]}
                      >
                        {feat.text}
                      </span>
                    </li>
                  ))}
                </ul>
              </div>
            ))
          }
        </div>
      </div>
    </section>

    <!-- Feature Comparison Table -->
    <section class="bg-gray-50 py-24" aria-label="Feature comparison">
      <div class="mx-auto max-w-6xl px-6">
        <SectionHeading
          eyebrow="Compare Plans"
          title="Feature comparison"
          subtitle="See exactly what's included in each plan."
        />

        <p class="mt-12 mb-2 text-xs text-gray-400 md:hidden" aria-hidden="true">
          Scroll sideways to see all plans &rarr;
        </p>
        <div class="overflow-x-auto rounded-xl" data-animate="fade-up">
          <table class="w-full min-w-[600px] border-collapse text-sm">
            <thead>
              <tr class="border-b border-gray-200 bg-white">
                <th class="sticky left-0 z-10 bg-white px-6 py-4 text-left font-semibold text-gray-900">
                  Feature
                </th>
                <th class="px-6 py-4 text-center font-semibold text-gray-900">
                  Starter
                </th>
                <th class="px-6 py-4 text-center font-semibold text-primary-600">
                  Professional
                </th>
                <th class="px-6 py-4 text-center font-semibold text-gray-900">
                  Enterprise
                </th>
              </tr>
            </thead>
            <tbody>
              {
                comparisonRows.map((row, i) => (
                  <tr
                    class:list={[
                      "border-b border-gray-100",
                      i % 2 === 0 ? "bg-white" : "bg-gray-50",
                    ]}
                  >
                    <td
                      class:list={[
                        "sticky left-0 z-10 px-6 py-3 font-medium text-gray-700",
                        i % 2 === 0 ? "bg-white" : "bg-gray-50",
                      ]}
                    >
                      {row.feature}
                    </td>
                    {[row.starter, row.professional, row.enterprise].map(
                      (val) => (
                        <td class="px-6 py-3 text-center">
                          {val === "check" ? (
                            <svg
                              class="mx-auto h-5 w-5 text-primary-600"
                              fill="none"
                              viewBox="0 0 24 24"
                              stroke="currentColor"
                              stroke-width="2"
                              role="img"
                              aria-label="Included"
                            >
                              <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                d={checkPath}
                              />
                            </svg>
                          ) : val === "x" ? (
                            <svg
                              class="mx-auto h-5 w-5 text-gray-300"
                              fill="none"
                              viewBox="0 0 24 24"
                              stroke="currentColor"
                              stroke-width="2"
                              role="img"
                              aria-label="Not included"
                            >
                              <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                d={xPath}
                              />
                            </svg>
                          ) : (
                            <span class="font-medium text-gray-700">
                              {val}
                            </span>
                          )}
                        </td>
                      )
                    )}
                  </tr>
                ))
              }
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- FAQ Section -->
    <section class="py-24" aria-label="Frequently asked questions">
      <div class="mx-auto max-w-5xl px-6">
        <SectionHeading
          eyebrow="FAQ"
          title="Frequently asked questions"
          subtitle="Everything you need to know about Ella's pricing and plans."
        />

        <div class="mt-12 grid gap-8 md:grid-cols-2" data-stagger>
          {
            faqItems.map((item) => (
              <div data-animate="fade-up">
                <h3 class="text-base font-semibold text-gray-900">
                  {item.question}
                </h3>
                <p class="mt-2 text-sm leading-relaxed text-gray-600">
                  {item.answer}
                </p>
              </div>
            ))
          }
        </div>
      </div>
    </section>

    <!-- Bottom CTA -->
    <CTASection
      title="Still have questions?"
      description="Schedule a demo with our team to discuss your firm's needs and find the perfect plan."
      buttonText="Request a Demo"
      buttonHref="/#contact"
    />
  </main>
</BaseLayout>
